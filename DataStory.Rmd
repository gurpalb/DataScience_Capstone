---
title: "Data Story - Capstone Project Milestone Report"
author: "Gurpal Bisra"
date: "May 15, 2016"
output: 
  html_document
---
<!-- ## R Markdown Help: <http://rmarkdown.rstudio.com> -->
**RStudio Version 0.99.896**

**R Version 3.3.0**

## Set the Working Directory and Install Packages

<!-- Set the Working Directory -->
```{r Working Directory, eval = FALSE}
setwd("//mac/Home/Desktop/Capstone/")
getwd()
```         
                      
<!-- Install Packages -->
```{r Libraries, eval = FALSE}
install.packages("rmarkdown", lib="C:/Program Files/R/R-3.3.0/library")
install.packages("knitr", lib="C:/Program Files/R/R-3.3.0/library")
install.packages("dplyr", lib="C:/Program Files/R/R-3.3.0/library")
install.packages("tidyr", lib="C:/Program Files/R/R-3.3.0/library")
install.packages("ggplot2", lib="C:/Program Files/R/R-3.3.0/library")
install.packages("DT", lib="C:/Program Files/R/R-3.3.0/library")    
install.packages("devtools", lib="C:/Program Files/R/R-3.3.0/library")
install.packages("Hmisc", lib="C:/Program Files/R/R-3.3.0/library")

library("rmarkdown")            # Dynamic documents
library("knitr")                # Run R Code Chunks
library("dplyr")                # Data Wrangling
library("tidyr")                # Data Wrangling
library("ggplot2")              # Plotting
library("DT")                   # Interactive HTML tables
library("devtools")             # To include the session information
library("Hmisc")                # Many functions for data analysis + visualization

.libPaths()
# [1] "\\\\Mac/Home/Documents/R/win-library/3.3" "C:/Program Files/R/R-3.3.0/library"
```

<!-- Set Codechunk Parameters -->
```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      eval = TRUE, 
                      message = FALSE,
                      warning = FALSE, 
                      fig.path = "Figures/",
                      fig.width = 12, 
                      fig.height = 8)
```

## Downloaded Datasets

1. **Death in the United States** 
-https://www.kaggle.com/cdc/mortality (Database)
    + **DeathRecords.csv =                  [Header, 1,048,576 > x 38]**
    + RecordAxisConditions.csv =            [Header, 1,048,576 > x 3]
    + EntityAxisConditions.csv =            [Header, 1,048,576 > x 6]
    + ActivityCode.csv =                    [Header, 9 x 2]
    + AgeRecode12.csv =                     [Header, 13 x 2]
    + AgeRecode27.csv =                     [Header, 28 x 2]
    + AgeRecode52.csv =                     [Header, 53 x 2]
    + AgeType.csv =                         [Header, 7 x 2]
    + BridgedRaceFlag.csv =                 [Header, 3 x 2]
    + DayOfWeekOfDeath.csv =                [Header, 9 x 2]
    + Education1989Revision.csv =           [Header, 20 x 2]
    + Education2003Revision.csv =           [Header, 10 x 2]
    + EducationReportingFlag.csv =          [Header, 4 x 2]
    + HispanicOrigin.csv =                  [Header, 205 x 2]
    + HispanicOriginRaceRecode.csv =        [Header, 10 x 2]
    + Icd10Code.csv =                       [Header, 21232 x 2]
    + InfantAgeRecode22.csv =               [Header, 24 x 2]
    + MannerOfDeath.csv =                   [Header, 9 x 2]
    + MaritalStatus.csv =                   [Header, 6 x 2]
    + MethodOfDisposition.csv =             [Header, 5 x 2]
    + PlaceOfDeathAndDecedentsStatus.csv =  [Header, 9 x 2]
    + PlaceOfInjury.csv =                   [Header, 12 x 2]
    + Race.csv =                            [Header, 17 x 2]
    + RaceImputationFlag.csv =              [Header, 4 x 2]
    + RaceRecode3.csv =                     [Header, 4 x 2]
    + RaceRecode5.csv =                     [Header, 6 x 2]
    + ResidentStatus.csv =                  [Header, 5 x 2]
    + CauseRecode39.csv =                   [Header, 41 x 2]
    
2. **Health Insurance Marketplace** -https://www.kaggle.com/hhsgov/health-insurance-marketplace
    + BenefitsCostSharing.csv = [Header, 1,048,576 > x 32]
    + BusinessRules.csv =       [Header, 21086 x 21]
    + Crosswalk2015.csv =       [Header, 132506 x 21]
    + Crosswalk2015.csv =       [Header, 150006 x 21]
    + Network.csv =             [Header, 3823 x 12]
    + PlanAttributes.csv =      [Header, 77354 x 176]
    + Rate.csv =                [Header, 1,048,576 > x 24]
    + ServiceArea.csv =         [Header, 42248 x 18]
        
3. **US Chronic Disease Indicators**
-http://catalog.data.gov/dataset/u-s-chronic-disease-indicators-cdi-ff843
    + USCDI.csv =  [Header, 53470 x 19]

4. **National Health Expenditures (US)**
-https://www.quandl.com/data/USCENSUS/HEALTH_EXP-National-Health-Expenditures-U-S
    + USNHE.csv =  [Header, 101 x 14]

## Load Datasets into RStudio

```{r Load Datasets, eval = FALSE, echo = TRUE}
# Read in and Examine Data Set #

# 1. Death in the United States
DRec <- read.csv("2/DeathRecords.csv", header = TRUE)
dim(DRec)
head(DRec, 20)
str(DRec)

# Replace Column Names for ease of typing and conform with naming standards #
DRec_names_new <- c('c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9', 'c10', 'c11', 'c12', 'c13', 'c14', 'c15', 'c16', 'c17', 'c18', 'c19', 'c20', 'c21', 'c22', 'c23', 'c24', 'c25', 'c26', 'c27', 'c28', 'c29', 'c30', 'c31', 'c32', 'c33', 'c34', 'c35', 'c36', 'c37', 'c38')
names(DRec) <- DRec_names_new
head(DRec)

# Create an internal reference table (for humans) for column headings and their defintions #

# Create two vectors, variable and definition then cbind into a descrition table #
variable <- c('c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9', 'c10', 'c11', 'c12', 'c13', 'c14', 'c15', 'c16', 'c17', 'c18', 'c19', 'c20', 'c21', 'c22', 'c23', 'c24', 'c25', 'c26', 'c27', 'c28', 'c29', 'c30', 'c31', 'c32', 'c33', 'c34', 'c35', 'c36', 'c37', 'c38')
definition <- c("Id", "ResidentStatus", "Education1989Revision", "Education2003Revision", "EducationReportingFlag", "MonthOfDeath", "Sex", "AgeType", "Age", "AgeSubstitutionFlag", "AgeRecode52", "AgeRecode27", "AgeRecode12", "InfantAgeRecode22", "PlaceOfDeathAndDecedentsStatus", "MaritalStatus", "DayOfWeekOfDeath", "CurrentDataYear", "InjuryAtWork", "MannerOfDeath", "MethodOfDisposition", "Autopsy", "ActivityCode", "PlaceOfInjury", "Icd10Code", "CauseRecode358", "CauseRecode113", "InfantCauseRecode130", "CauseRecode39", "NumberOfEntityAxisConditions", "NumberOfRecordAxisConditions", "Race", "BridgedRaceFlag", "RaceImputationFlag", "RaceRecode3", "RaceRecode5", "HispanicOrigin", "HispanicOriginRaceRecode")
DRec_descriptions_table <- cbind(variable, definition)
DRec_descriptions_table

#  [1] "Id"                             "ResidentStatus"                
#  [3] "Education1989Revision"          "Education2003Revision"         
#  [5] "EducationReportingFlag"         "MonthOfDeath"                  
#  [7] "Sex"                            "AgeType"                       
#  [9] "Age"                            "AgeSubstitutionFlag"           
# [11] "AgeRecode52"                    "AgeRecode27"                   
# [13] "AgeRecode12"                    "InfantAgeRecode22"             
# [15] "PlaceOfDeathAndDecedentsStatus" "MaritalStatus"                 
# [17] "DayOfWeekOfDeath"               "CurrentDataYear"               
# [19] "InjuryAtWork"                   "MannerOfDeath"                 
# [21] "MethodOfDisposition"            "Autopsy"                       
# [23] "ActivityCode"                   "PlaceOfInjury"                 
# [25] "Icd10Code"                      "CauseRecode358"                
# [27] "CauseRecode113"                 "InfantCauseRecode130"          
# [29] "CauseRecode39"                  "NumberOfEntityAxisConditions"  
# [31] "NumberOfRecordAxisConditions"   "Race"                          
# [33] "BridgedRaceFlag"                "RaceImputationFlag"            
# [35] "RaceRecode3"                    "RaceRecode5"                   
# [37] "HispanicOrigin"                 "HispanicOriginRaceRecode"

# Check for missing values and visually inspect length #
DRec_check <- na.omit(DRec)
length(DRec$c26)
length(DRec_check$c26)
# Both [1] 2631171

# Remove irrelevant columns
# DRec1 <- DRec[ , -which(names(DRec) %in% c("c1","c18", "c25", # "c27", "c29", "c27", "c7", "c16", "c19", "c21", "c22"))]

DRec2 <- DRec[ , c(7,9,20,24,26, 27, 28, 29)]

sample1 <- DRec2[sample(1:nrow(DRec2), "100", replace = FALSE), ]
plot(sample1)
# par("mar")
# [1] 5.1 4.1 4.1 2.1
# par("mgp")
# [1] 3 1 0
# par("las")
# [1] 0

# Also plot the histogram for the Manner of Death
ggplot(DRec, aes(x = c20)) + geom_histogram(binwidth=1)

# ---------------------------------------------------------------
# 2. Health Insurance Marketplace
BCS <- read.csv("1/BenefitsCostSharing.csv", header = TRUE)
dim(BCS)
# [1] 5048408   32
dim(BCS)
head(BCS, 20)
str(BCS)

# Replace Column Names for ease of typing and conform with naming standards #
BCS_names_new <- c('c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9', 'c10', 'c11', 'c12', 'c13', 'c14', 'c15', 'c16', 'c17', 'c18', 'c19', 'c20', 'c21', 'c22', 'c23', 'c24', 'c25', 'c26', 'c27', 'c28', 'c29', 'c30', 'c31', 'c32')
names(BCS) <- BCS_names_new
head(BCS)

# Create an internal reference table (for humans) for column headings and their defintions #

# Create two vectors, variable and definition then cbind into a descrition table #
variable2 <- c('c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9', 'c10', 'c11', 'c12', 'c13', 'c14', 'c15', 'c16', 'c17', 'c18', 'c19', 'c20', 'c21', 'c22', 'c23', 'c24', 'c25', 'c26', 'c27', 'c28', 'c29', 'c30', 'c31', 'c32')
definition2 <- c("BenefitName", "BusinessYear", "CoinsInnTier1", "CoinsInnTier2", "CoinsOutofNet", "CopayInnTier1", "CopayInnTier2", "CopayOutofNet", "EHBVarReason", "Exclusions", "Explanation", "ImportDate", "IsCovered", "IsEHB", "IsExclFromInnMOOP", "IsExclFromOonMOOP", "IsStateMandate", "IsSubjToDedTier1", "IsSubjToDedTier2", "IssuerId", "IssuerId2", "LimitQty", "LimitUnit", "MinimumStay", "PlanId", "QuantLimitOnSvc", "RowNumber", "SourceName", "StandardComponentId", "StateCode", "StateCode2", "VersionNum")
BCS_descriptions_table <- cbind(variable2, definition2)
BCS_descriptions_table

#  [1] "BenefitName"         "BusinessYear"       
#  [3] "CoinsInnTier1"       "CoinsInnTier2"      
#  [5] "CoinsOutofNet"       "CopayInnTier1"      
#  [7] "CopayInnTier2"       "CopayOutofNet"      
#  [9] "EHBVarReason"        "Exclusions"         
# [11] "Explanation"         "ImportDate"         
# [13] "IsCovered"           "IsEHB"              
# [15] "IsExclFromInnMOOP"   "IsExclFromOonMOOP"  
# [17] "IsStateMandate"      "IsSubjToDedTier1"   
# [19] "IsSubjToDedTier2"    "IssuerId"           
# [21] "IssuerId2"           "LimitQty"           
# [23] "LimitUnit"           "MinimumStay"        
# [25] "PlanId"              "QuantLimitOnSvc"    
# [27] "RowNumber"           "SourceName"         
# [29] "StandardComponentId" "StateCode"          
# [31] "StateCode2"          "VersionNum"  

# Check for missing values and visually inspect length #
BCS_check <- na.omit(BCS)
length(BCS$c13)
# [1] 5048408
length(BCS_check$c13)
# [1] 568; therefore, missing values

BCS1 <- BCS[ , c(13,30)]

sample2 <- BCS1[sample(1:nrow(BCS1), "100", replace = FALSE), ]
plot(sample2)

# ---------------------------------------------------------------

# 3. US Chronic Disease Indicators
USCDI <- read.csv("USCDI.csv", header = TRUE)
dim(USCDI)
# [1] 53469   19
dim(USCDI)
head(USCDI, 20)
str(USCDI)

# Replace Column Names for ease of typing and conform with naming standards #
USCDI_names_new <- c('c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9', 'c10', 'c11', 'c12', 'c13', 'c14', 'c15', 'c16', 'c17', 'c18', 'c19')
names(USCDI) <- USCDI_names_new
head(USCDI)

# Create an internal reference table (for humans) for column headings and their defintions #

# Create two vectors, variable and definition then cbind into a descrition table #
variable3 <- c('c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9', 'c10', 'c11', 'c12', 'c13', 'c14', 'c15', 'c16', 'c17', 'c18', 'c19')
definition3 <- c("ï..Year", "LocationAbbr", "LocationDesc", "Category", "Indicator", "Datasource", "DataValueUnit", "DataValueType", "DataValue", "DataValueAlt", "DataValueFootnoteSymbol", "DataValueFootnote", "Gender", "StratificationID1", "IndicatorID", "LocationID", "LowConfidenceInterval", "HighConfidenceInterval", "GeoLocation")          
USCDI_descriptions_table <- cbind(variable3, definition3)
USCDI_descriptions_table

#  [1] "ï..Year"                 "LocationAbbr"           
#  [3] "LocationDesc"            "Category"               
#  [5] "Indicator"               "Datasource"             
#  [7] "DataValueUnit"           "DataValueType"          
#  [9] "DataValue"               "DataValueAlt"           
# [11] "DataValueFootnoteSymbol" "DataValueFootnote"      
# [13] "Gender"                  "StratificationID1"      
# [15] "IndicatorID"             "LocationID"             
# [17] "LowConfidenceInterval"   "HighConfidenceInterval" 
# [19] "GeoLocation"            

# Check for missing values and visually inspect length #
USCDI_check <- na.omit(USCDI)
length(USCDI$c2)
# [1] 0 
length(USCDI_check$c2)
# [1] 0; not indicative since character data

USCDI1 <- USCDI[ , c(2,4)]

sample3 <- USCDI1[sample(1:nrow(USCDI), "1000", replace = FALSE), ]
plot(sample3)

# ---------------------------------------------------------------

# 4. National Health Expenditures (US)
NHE <- read.csv("USNHE.csv", header = TRUE)
dim(NHE)
# [1] 100   14
dim(NHE)
head(NHE, 20)
str(NHE)

# Replace Column Names for ease of typing and conform with naming standards #
NHE_names_new <- c('c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9', 'c10', 'c11', 'c12', 'c13', 'c14')
names(NHE) <- NHE_names_new
head(NHE)

# Create an internal reference table (for humans) for column headings and their defintions #

# Create two vectors, variable and definition then cbind into a descrition table #
variable4 <- c('c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9', 'c10', 'c11', 'c12', 'c13', 'c14')
definition4 <- c("Year", "National.Health.Expenditures", "Health.Consumption.Expenditures", "Total", "Hospital.Care", "Physician.and.Clinical.Services", "Other.Professional.Services", "Dental.Services", "Other.Health.Residential.and.Personal", "Home.Health.Care", "Nursing.Care", "Prescription.Drugs", "Durable.Medical.Equipment", "Other.Non.Durable.Equipment")  
NHE_descriptions_table <- cbind(variable4, definition4)
NHE_descriptions_table

#  [1] "Year"                                 
#  [2] "National.Health.Expenditures"         
#  [3] "Health.Consumption.Expenditures"      
#  [4] "Total"                                
#  [5] "Hospital.Care"                        
#  [6] "Physician.and.Clinical.Services"      
#  [7] "Other.Professional.Services"          
#  [8] "Dental.Services"                      
#  [9] "Other.Health.Residential.and.Personal"
# [10] "Home.Health.Care"                     
# [11] "Nursing.Care"                         
# [12] "Prescription.Drugs"                   
# [13] "Durable.Medical.Equipment"            
# [14] "Other.Non.Durable.Equipment"

# Check for missing values and visually inspect length #
NHE_check <- na.omit(NHE)
length(NHE$c11)
# [1] 100 
length(NHE_check$c11)
# [1] 100; not missing any data

NHE1 <- NHE[ , c(4,5,6,7,8,9,10,11,12,13.14)]

sample4 <- NHE1[sample(1:nrow(NHE1), "100", replace = FALSE), ]
plot(sample4)

```       

## Data Exploration
I want to explore the data of people who died of natural causes including sex, age, race. 

```{r Headers, eval = FALSE, echo = TRUE}

AgeType<-read.csv("2/AgeType.csv",stringsAsFactors = F,header = T)

```

## Cleanup Relevant DeathRecords Dataset Variables

```{r DeathRecords, eval = FALSE, echo = TRUE}


```

## Death Records EDA - find the most common preventable deaths

```{r Death Records EDA, eval = FALSE, echo = TRUE}
# Death Count vs. Manner of Death
ggplot(DRec, aes(x = c20)) +
  geom_histogram(binwidth = 1)
# Most people died of natural causes

# Remove rows of people who died of causes other than natural death
DRec3 <- DRec[DRec$MannerOfDeath == 7, ]


```

## View Plots

```{r Plots1, echo = TRUE}


```


<!-- My Data Story - Capstone Project Milestone Report --> 
## 1. An Introduction to the Problem

**I want to determine which areas of healthcare prevention should have better funding, and research dedicated to, for preventing future deaths in the United States.** Pursuing finding a solution to this problem would allow me to leverage my domain knowledge ascertained through volunteering in healthcare organizations such as the Vancouver Crisis Centre, Health Initiative for Men, and the Scotiabank AIDS Walk for Life, and King's College Hospital NHS Foundation. I would like to work with USA data and extrapolate my results, under certain assumptions, for improving Canadian healthcare.

Determining which areas of prevention can be better funded to prevent future deaths in the USA will result in less money spent on healthcare dollars. My clients are health centers, such as hospitals, that distribute healthcare services under ObamaCare. They would care about this problem because if more money is saved while providing healthcare, they can hire new staff, afford to introduce new healthcare technologies, serve a greater number of people, and the wait times should be shorter. For example, my clients are currently having difficulty keeping their costs low as the rate of healthcare expenditure increases nationwide. The results of my analysis would allow my client to instead make decisions regarding their practices to reduce their overall costs in the long-run. This solves the aforementioned project above.

## 2. A Deeper Dive into the Data Set:

### 2a. What important fields and information does the data set have?

### 2b. What are its limitations i.e. what are some questions that you cannot answer with this data set?

### 2c. What kind of cleaning and wrangling did you need to do?

## 2. Any preliminary exploration you've performed and your initial findings.

## 3. What Approal Will be Used? How is it Different than Initially Proposed?

**My original approach included the following steps:**

1. Download the nine datasets mentioned in the previous section.
2. For each dataset:
    + Load it into R
    + Read the headers
    + Determine which variables are dependent and independent
    + Explore the data by plotting dependent vs. indepenent variables
    + Go deeper where trends are observed.
3. Determine which variables are common or related. 
    + In particular, I will determine which output variables have multiple input variables
    + Combine data that are related to the same output
4. Combine my relevant data into a single dataset.
    + Requires datawrangling libraries: "dplyr" and "tidyr"
5. Visualize data by graphs to communicate my data story flow:
    + Requires plotting library: "ggplot2"
    + Find most common diseases which kill people --> 
    + How can these diseases be prevented (i.e. prevention) --> 
    + What variables affect prevention --> 
    + Is funding allocated to each variable?
6. Construct a model to answer my data science question.
7. Write regression or machine learning algorithms to predict how the number of deaths can be prevented in the future by funding certain prevention variables
8. Develop visualizations of my data and include them in my slide deck. 